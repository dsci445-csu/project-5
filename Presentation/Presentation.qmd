---
title: "Illinois DOC Sentencing Machine Learning Analysis"
author: Juan Gonzalez, Aaron Graff, Ilijah Pearson, Hope Winsor
format: pptx
editor: visual
---

## Dataset and Preparation


Our data comes from Kaggle, it consists of 3 CSV files with data scraped off the Illinois Department Of Corrections website.

::: incremental
- Contains information 61,052 individuals who have been incarcerated in Illinois from 1952-2018. 

- "Person" dataset includes simple descriptive information on the person: Name, DOB, Sentencing Date, Race, Eye Color, Hair Color, etc... 
- "Marks" has multiple rows per person listing any additional descriptive features like scars and tattoos.
- "Sentencing" is information on the charges faced by the individual, the crime categorized by Illinois' felony classes, and our response variable, sentencing time.

:::

## Research Questions

::: incremental
- What predictors have the strongest effect on sentencing length?

- How accurately can we predict sentencing length?

- What predictors have the strongest effect on offence category?

- How accurately can we predict offence categories?
:::

## KNN

## Linear Regression

## GAM

## Random Forest


:::columns
:::column

-   Chosen to deal with correlation amongst trees.
-   58,836 observations. 70:30 Split  $\sim$ (41,200 | 17,600)
-   Fit 500 trees with 4 randomly chosen predictors for each tree.
-   Out-of-Bag error is calculated by checking the performance of each tree on a subset of unseen data during the training process.  
:::

:::column

```{r, echo=FALSE, fig.width=12, fig.height=8.25}

library(vip)
library(tidyverse)
library(randomForest)
library(pdp)

#You must use download link to download the rds file locally and adjust it to your pathway to the rds.
#
rf_fit <- readRDS("~/Documents/RFfit_model_juan.rds")
#rf_fit <- readRDS("../Code/RFfit_model_juan.rds")



vi <- vi(rf_fit$fit) %>%
  top_n(5, Importance) %>%
  mutate(Variable = recode(Variable,
                           year_adm = "Year Admitted",
                           parent_institution = "Parent Institution",
                           total_counts = "Total Counts",
                           time_sentenced_prior = "Prior Sentencing Time",
                           class = "Illinois Felony Class",
                           ))

vip(vi, aesthetics = list(fill = "coral4"))  +
  ggtitle("5 Most Important Predictors in our Random Forests Model") + theme_bw() + 
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text = element_text(size = 13),
        plot.title = element_text(size = 16, hjust = 0.5))



```

:::
:::





## Predictive Performance - Random Forests

::: columns
::: column
- **12.11** OOB RMSE / **12. 18** Test RMSE. Similar RMSEs is good (generalizes well).
- As sentencing length goes up, our models prediction becomes more variable. However, the models' errors scale proportionally to sentencing length. Meaning we don't typically get crazy predictions for lower sentencing lengths.
:::

::: column

```{r, echo=FALSE, fig.width=8}

rmses <- read_csv("../CSV Files/RF_RMSEbySentencing.csv")


ggplot(data = rmses, aes(x = current_sentence_rnd, y = rmse)) + 
  labs(title = "RMSE by Sentence Length", x = "Sentencing Time", y = "RMSE") +
  geom_smooth(method = "loess", se = FALSE, color = "coral4") + geom_line() +
  theme_bw()+theme(plot.title = element_text(hjust = 0.5))

```

:::
:::

## Conclusion

## References

-https://www.kaggle.com/datasets/davidjfisher/illinois-doc-labeled-faces-dataset
-https://www.idoc.state.il.us



## Questions? 

## Bonus Slides - Complete Variable Importance for RF


```{r, echo=FALSE, fig.width=8}
vi_all <- vi(rf_fit$fit) %>%
  top_n(20, Importance) #%>%
  # mutate(Variable = recode(Variable,
  #                          year_adm = "Year Admitted",
  #                          parent_institution = "Parent Institution",
  #                          total_counts = "Total Counts",
  #                          time_sentenced_prior = "Prior Sentencing Time",
  #                          class = "Illinois Felony Class",
  # ))

vip(vi_all, num_features = 20,aesthetics = list(fill = "coral4"))  +
  ggtitle("Variable Importance Plot for our Random Forests Model") + theme_bw()




```

